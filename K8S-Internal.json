{
	"tasks": [{
		"environment": {},
		"displayName": "Bash 脚本",
		"alwaysRun": false,
		"continueOnError": false,
		"condition": "succeeded()",
		"enabled": true,
		"timeoutInMinutes": 0,
		"inputs": {
			"targetType": "inline",
			"filePath": "",
			"arguments": "",
			"script": "# Write your commands here\n\necho \"containerNamespace:\"\"$(containerNamespace)\"\necho \"dockerRepository:\"\"$(dockerRepository)\"\necho \"replicas:\"\"$(replicas)\"\necho \"serviceName:\"\"$(serviceName)\"\necho \"ingressClass:\"\"$(ingressClass)\"\necho \"ingressSubnetId:\"\"$(ingressSubnetId)\"\necho \"sku:\"\"$(sku)\"\necho \"prodType:\"\"$(prodType)\"\necho \"appType:\"\"$(appType)\"",
			"workingDirectory": "",
			"failOnStderr": "false",
			"noProfile": "true",
			"noRc": "true"
		},
		"task": {
			"id": "6c731c3c-3c68-459a-a5c9-bde6e6595b5b",
			"versionSpec": "3.*",
			"definitionType": "task"
		}
	}, {
		"environment": {},
		"displayName": "createSecret",
		"alwaysRun": false,
		"continueOnError": false,
		"condition": "succeeded()",
		"enabled": true,
		"timeoutInMinutes": 0,
		"inputs": {
			"action": "createSecret",
			"kubernetesServiceConnection": "",
			"namespace": "$(K8sNamespace)",
			"strategy": "none",
			"trafficSplitMethod": "pod",
			"percentage": "0",
			"baselineAndCanaryReplicas": "1",
			"manifests": "",
			"containers": "",
			"imagePullSecrets": "",
			"renderType": "helm",
			"dockerComposeFile": "",
			"helmChart": "",
			"releaseName": "",
			"overrideFiles": "",
			"overrides": "",
			"kustomizationPath": "",
			"resourceToPatch": "file",
			"resourceFileToPatch": "",
			"kind": "",
			"name": "",
			"replicas": "3",
			"mergeStrategy": "strategic",
			"arguments": "",
			"patch": "",
			"secretType": "dockerRegistry",
			"secretName": "regcred",
			"secretArguments": "",
			"dockerRegistryEndpoint": "b1948a6c-bb6b-4521-80b6-f73e09042c71",
			"rolloutStatusTimeout": "0"
		},
		"task": {
			"id": "dee316a2-586f-4def-be79-488a1f503dfe",
			"versionSpec": "0.*",
			"definitionType": "task"
		}
	}, {
		"environment": {},
		"displayName": "bake",
		"alwaysRun": false,
		"continueOnError": false,
		"condition": "succeeded()",
		"enabled": true,
		"timeoutInMinutes": 0,
		"inputs": {
			"action": "bake",
			"kubernetesServiceConnection": "",
			"namespace": "$(K8sNamespace)",
			"strategy": "none",
			"trafficSplitMethod": "pod",
			"percentage": "0",
			"baselineAndCanaryReplicas": "1",
			"manifests": "",
			"containers": "$(dockerRepository)/$(containerNamespace)/$(serviceName):$(Build.BuildId)",
			"imagePullSecrets": "",
			"renderType": "helm",
			"dockerComposeFile": "",
			"helmChart": "$(yamlPath)",
			"releaseName": "$(serviceName)",
			"overrideFiles": "",
			"overrides": "dockerRepository:$(dockerRepository)\nreplicaCount:$(replicas)\ndeploymentType:$(sku)\ningress.annotations.kubernetes\\.io\\/ingress\\.class:$(ingressClass)\ningress.annotations.kubernetes\\.io\\/ingress\\.subnetId:$(ingressSubnetId)\nprodType:$(prodType)\ncontainerNamespace:$(containerNamespace)\nappType:$(appType)\nhostSuffix:$(hostSuffix)",
			"kustomizationPath": "",
			"resourceToPatch": "file",
			"resourceFileToPatch": "",
			"kind": "",
			"name": "bake",
			"replicas": "3",
			"mergeStrategy": "strategic",
			"arguments": "",
			"patch": "",
			"secretType": "dockerRegistry",
			"secretName": "",
			"secretArguments": "",
			"dockerRegistryEndpoint": "",
			"rolloutStatusTimeout": "0"
		},
		"task": {
			"id": "dee316a2-586f-4def-be79-488a1f503dfe",
			"versionSpec": "0.*",
			"definitionType": "task"
		}
	}, {
		"environment": {},
		"displayName": "Bash 脚本",
		"alwaysRun": false,
		"continueOnError": false,
		"condition": "succeeded()",
		"enabled": true,
		"timeoutInMinutes": 0,
		"inputs": {
			"targetType": "inline",
			"filePath": "",
			"arguments": "",
			"script": "# Write your commands here\necho \"##vso[task.setvariable variable=mainfest]$KUBERNETESMANIFEST2_MANIFESTSBUNDLE\"",
			"workingDirectory": "",
			"failOnStderr": "false",
			"noProfile": "true",
			"noRc": "true"
		},
		"task": {
			"id": "6c731c3c-3c68-459a-a5c9-bde6e6595b5b",
			"versionSpec": "3.*",
			"definitionType": "task"
		}
	}, {
		"environment": {},
		"displayName": "deploy",
		"alwaysRun": false,
		"continueOnError": false,
		"condition": "succeeded()",
		"enabled": true,
		"timeoutInMinutes": 0,
		"inputs": {
			"action": "deploy",
			"kubernetesServiceConnection": "",
			"namespace": "$(K8sNamespace)",
			"strategy": "none",
			"trafficSplitMethod": "pod",
			"percentage": "0",
			"baselineAndCanaryReplicas": "1",
			"manifests": "$(mainfest)",
			"containers": "$(dockerRepository)/$(containerNamespace)/$(serviceName):$(Build.BuildId)",
			"imagePullSecrets": "regcred",
			"renderType": "helm",
			"dockerComposeFile": "",
			"helmChart": "",
			"releaseName": "",
			"overrideFiles": "",
			"overrides": "",
			"kustomizationPath": "",
			"resourceToPatch": "file",
			"resourceFileToPatch": "",
			"kind": "",
			"name": "",
			"replicas": "3",
			"mergeStrategy": "strategic",
			"arguments": "",
			"patch": "",
			"secretType": "dockerRegistry",
			"secretName": "",
			"secretArguments": "",
			"dockerRegistryEndpoint": "",
			"rolloutStatusTimeout": "0"
		},
		"task": {
			"id": "dee316a2-586f-4def-be79-488a1f503dfe",
			"versionSpec": "0.*",
			"definitionType": "task"
		}
	}],
	"runsOn": ["Agent"],
	"revision": 3,
	"comment": "",
	"id": "0d1d1203-c7f4-4198-95d7-6b9168604b56",
	"name": "K8S线上部署 - Internal ",
	"version": {
		"major": 1,
		"minor": 0,
		"patch": 0,
		"isTest": false
	},
	"iconUrl": "/tfs/_static/tfs/Dev18.M181.6/_content/icon-meta-task.png",
	"friendlyName": "K8S线上部署 - Internal",
	"description": "部署K8s的任务组。\n由于一些已知原因请一个管道内仅能包含一个该任务，需要多个的请分开管道处理，否则可能会错误",
	"category": "Deploy",
	"definitionType": "metaTask",
	"author": "LeoLaw",
	"demands": [],
	"groups": [],
	"inputs": [{
		"aliases": [],
		"options": {},
		"properties": {},
		"name": "appType",
		"label": "appType",
		"defaultValue": "app",
		"required": true,
		"type": "string",
		"helpMarkDown": "App类型，有效值app,funtion,dapr",
		"groupName": ""
	}, {
		"aliases": [],
		"options": {},
		"properties": {},
		"name": "containerNamespace",
		"label": "containerNamespace",
		"defaultValue": "",
		"required": true,
		"type": "string",
		"helpMarkDown": "镜像所在的的命名空间",
		"groupName": ""
	}, {
		"aliases": [],
		"options": {},
		"properties": {},
		"name": "dockerRepository",
		"label": "dockerRepository",
		"defaultValue": "",
		"required": true,
		"type": "string",
		"helpMarkDown": "docker仓库,一般默认值即可",
		"groupName": ""
	}, {
		"aliases": [],
		"options": {},
		"properties": {},
		"name": "hostSuffix",
		"label": "hostSuffix",
		"defaultValue": "",
		"required": true,
		"type": "string",
		"helpMarkDown": "域名后缀,一般默认值即可",
		"groupName": ""
	}, {
		"aliases": [],
		"options": {},
		"properties": {},
		"name": "ingressClass",
		"label": "ingressClass",
		"defaultValue": "",
		"required": true,
		"type": "string",
		"helpMarkDown": "Ingress的kubernetes.io/ingress.class的值",
		"groupName": ""
	}, {
		"aliases": [],
		"options": {},
		"properties": {},
		"name": "ingressSubnetId",
		"label": "ingressSubnetId",
		"defaultValue": "",
		"required": true,
		"type": "string",
		"helpMarkDown": "ingress的kubernetes.io/ingress.subnetId的值",
		"groupName": ""
	}, {
		"aliases": [],
		"options": {},
		"properties": {},
		"name": "K8sNamespace",
		"label": "K8sNamespace",
		"defaultValue": "",
		"required": true,
		"type": "string",
		"helpMarkDown": "使用 -namespace 标志设置命令的命名空间。如果未提供命名空间，则命令将在默认命名空间中运行。",
		"groupName": ""
	}, {
		"aliases": [],
		"options": {},
		"properties": {},
		"name": "prodType",
		"label": "prodType",
		"defaultValue": "prod",
		"required": true,
		"type": "string",
		"helpMarkDown": "",
		"groupName": ""
	}, {
		"aliases": [],
		"options": {},
		"properties": {},
		"name": "replicas",
		"label": "replicas",
		"defaultValue": "",
		"required": true,
		"type": "string",
		"helpMarkDown": "K8s的deployment的副本数",
		"groupName": ""
	}, {
		"aliases": [],
		"options": {},
		"properties": {},
		"name": "serviceName",
		"label": "serviceName",
		"defaultValue": "",
		"required": true,
		"type": "string",
		"helpMarkDown": "服务名称",
		"groupName": ""
	}, {
		"aliases": [],
		"options": {},
		"properties": {},
		"name": "sku",
		"label": "sku",
		"defaultValue": "",
		"required": true,
		"type": "string",
		"helpMarkDown": "要部署的pod的大小类型(small/normal/large/work)",
		"groupName": ""
	}, {
		"aliases": [],
		"options": {},
		"properties": {},
		"name": "yamlPath",
		"label": "yamlPath",
		"defaultValue": "$(System.ArtifactsDirectory)/yaml",
		"required": true,
		"type": "filePath",
		"helpMarkDown": "要生成的 Helm 图表路径",
		"groupName": ""
	}],
	"satisfies": [],
	"sourceDefinitions": [],
	"dataSourceBindings": [],
	"instanceNameFormat": "任务组: K8S线上部署 - Internal $(serviceName)",
	"preJobExecution": {},
	"execution": {},
	"postJobExecution": {}
}